# Hello Developers
This is a quick guide on how to get started on BPCL’s Enterprise SMS API called _SMSPro_.

_SMS Pro_ uses industry standard _OAuth2_ for authentication. We’ll not talk about OAuth here as it’s out of scope of this document.

However, rest assured all major API Vendors e.g. Google, Facebook, Twitter, Instagram etc. use _OAuth2_ for their APIs.

_SMS Pro_ uses _Client Credentials_ grant type of OAuth among many others.

## 1. Registration
Before you call SMS Pro API, you need to register your application [here][Link: Application Registration]. Register and come back here.

Once you’ve registered your application, you’ll get `client_id` and `client_secret`.
`client id` is a uniuqe identifier for your application and `client_secret` is like a password, DO NOT SHARE IT WITH ANYONE.

## 2. Calling API
If you're using .NET check our [SMS Pro Client SDK (.NET)][Link: .NET Client SDK]​, which sends SMS in just one line of code.

Or continue...​

So, there are 2 steps to call _SMS Pro_ API.

1. Getting Access Token.
2. Using Token to call SMS API.​

For code samples, see [Calling SMS Pro API: Code Samples][Link: Code Samples]​.

## 2.1 Getting Access Token
Send A `POST` request to [/oauth2/token][Endpoint: OAuth2 Token] endpoint for getting an _OAuth2_ token.

### 2.1.1 Request
A typical request looks like this:

````http
POST .../oauth2/token HTTP/1.1
Host: SMS Pro API URL
Content-Type: application/x-www-form-urlencoded

client_id=1234&client_secret=12345&grant_type=client_credentials
````
> Content-Type: `application/x-www-form-urlencoded` requires values to be URL-Encoded and then passed to the API.

### 2.1.2 Response
For which the `JSON` response will look like this:
````json
{
  "access_token": "faXvojWzmCbCxNhdwv...", --Shortedned for brevity
  "token_type": "bearer",
  "expires_in": 3599
}
````
This is `bearer` type token, The token also contains an `expires_in` parameter, which tell for how many seconds this token in valid and can be used.
In this case it’s 3599 seconds i.e. ~60 minutes.

Take this `access_token` which will be used to access protected resource, in this case SMS Pro API

## 2.2 Using Token to call SMS API
Send a `POST` request to [/api/SMS][Endpoint: SMS API] endpoint.
There are 2 parameters `Mobile` and `Message`. For validations see section 3 of this document.

### 2.2.1 Request
Your request may look like this.

````HTTP
POST .../​​api/SMS HTTP/1.1
Host: localhost:1472
Authorization: Bearer NJzhrzHTzZ_oJh7XK0i-l9VnEh-1_ssW... --Shortened for brevity
Content-Type: application/x-www-form-urlencoded

Mobile=9167005157&Message=Hi%2C+Satish+Yadav!+This+is+a+demo+SMS+from+BPCL+SMS+Pro.
````

> You can also send `JSON` payload with `Content-Type` header as `appplication/json`

### 2.2.2 Response
If everything goes okay, you’ll get an `HTTP 204 (No Content)` or `HTTP 202 (Accepted)` HTTP Response.

If any validation fails, you’ll get `HTTP 400 (Bad Request)`. Read section 3 for more about validations.


## 2.3 Using Token to call Batch SMS API
Send a `POST` request to [/api/Batch][Endpoint: Batch SMS API] endpoint.
Pass a collection of `mobile` and `message`, and `id`. For validations see section 3 of this document.

> `Id` should be a unique identifier `string` of an individual SMS generated by you.

### 2.3.1 Request
Your request may look like this.

````HTTP
POST .../api/Batch HTTP/1.1
Host: localhost:1472
Authorization: Bearer NJzhrzHTzZ_oJh7XK0i-l9VnEh-1_ssW... --Shortened for brevity
Content-Type: application/json
````
````JSON
[
  {
    "id": "1a9efe74-84f8-4b77-802d-5ba5ee4e5b54",
    "message": "This is a test SMS",
    "mobile": "9167005157"
  },
  {
    "id": "a68f579e-53dc-4fc2-a848-495166bdbb41",
    "message": "",
    "mobile": "1234567890"
  },
  {
    "id": "a7dc3caa-bd21-49a9-b119-12af7f89b738",
    "mobile": "",
    "message": "This is a valid test SMS."
  }
]
````

### 2.3.2 Response
Since this is a batch request, you may get following response:

* If everything is okay, you'll get an `HTTP 204 (No Content)

````HTTP
HTTP/1.1 204 No Content
````

* In case there are any validation errors in any of the item in collection, you'll get an `HTTP 202 (Accepted)` with response errors corresponding to item(s) in collection.

> Rest of the valid items would be processed and SMS would be sent.

````HTTP
HTTP/1.1 202 OK
Content-Type: application/json; charset=utf-8
````
````JSON
[
  {
    "request": {
      "id": "a68f579e-53dc-4fc2-a848-495166bdbb41",
      "mobile": "1234567890",
      "message": ""
    },
    "error": {
      "Mobile": [
        "Mobile should be a valid indian mobile number with/without +91/0."
      ],
      "Message": [
        "The Message field is required.",
        "Message doesn't contain all the configured keywords."
      ]
    }
  },
  {
    "request": {
      "id": "a7dc3caa-bd21-49a9-b119-12af7f89b738",
      "mobile": "",
      "message": "This is a valid test SMS."
    },
    "error": {
      "Mobile": [
        "The Mobile field is required."
      ]
    }
  }
]
````
## 2.4 Using Token to call Delivery OData API
This endpoint is an `OData` endpoint, you can filter, sort, page, and select just like any other `OData` endpoint.

Read about OData more [here][Endpoint: OData Basics].


### 2.4.1 Request

Send a `GET` request to [/odata/Delivery][Endpoint: Delivery OData API] endpoint.

````HTTP
GET /Sms/odata/Delivery?$skip=10&$top=10&$orderby=CreatedOn&$filter=Status eq 'Delivered' or Status eq 'Failed' HTTP/1.1
Authorization: Bearer C_6ixXoQT...
````

### 2.4.2 Response
Response will be an HTTP 200 and should look like this:

````HTTP
HTTP/1.1 200 Ok
````
````JSON
{
    "@odata.context": "http://<SERVER_NAME>/Sms/odata/$metadata#Delivery",
    "value": [
        {
            "Id": "18437568-6a70-4ec5-9af4-0731e89760cc",
            "Mobile": "9123456789",
            "Status": "Delivered",
            "CreatedOn": "2019-05-16T15:41:31.9866667+05:30",
            "UpdatedOn": "2019-05-17T22:10:57.9086437+05:30",
            "DeliveredOn": "2019-05-16T15:41:37+05:30",
            "Reason": "HTTP_Delivery Success"
        },
        {
            "Id": "6b1ebfbb-0cfb-4001-a6ce-847277daa3c3",
            "Mobile": "9876543210",
            "Status": "Sent",
            "CreatedOn": "2019-05-16T15:41:31.9866667+05:30",
            "UpdatedOn": "2019-05-17T22:11:05.7526298+05:30",
            "DeliveredOn": null,
            "Reason": "Sent Success To Service Provider Via HTTP"
        },
        {
            "Id": "473de73e-194b-45a5-88c8-84b0a00a79d8",
            "Mobile": "9123456789",
            "Status": "Failed",
            "CreatedOn": "2019-05-16T15:41:31.9866667+05:30",
            "UpdatedOn": "2019-05-17T22:11:10.5027481+05:30",
            "DeliveredOn": "2019-05-16T15:41:37+05:30",
            "Reason": "Message failed/expired"
        },
        {
            "Id": "7009ae1a-d959-4c10-a785-eebccfa65190",
            "Mobile": "9876543210",
            "Status": "Delivered",
            "CreatedOn": "2019-05-16T15:41:31.9866667+05:30",
            "UpdatedOn": "2019-05-17T22:10:57.9242736+05:30",
            "DeliveredOn": "2019-05-16T15:41:37+05:30",
            "Reason": "HTTP_Delivery Success"
        },
        {
            "Id": "f1d24506-55b0-4d95-abcc-f55a80d229d8",
            "Mobile": "9123456789",
            "Status": "Sent",
            "CreatedOn": "2019-05-16T15:41:31.9866667+05:30",
            "UpdatedOn": "2019-05-17T22:11:10.3152401+05:30",
            "DeliveredOn": null,
            "Reason": "Sent Success To Service Provider Via HTTP"
        }
    ]
}
````

* In case there are any validation errors you'll get an HTTP 400 along with error messages.

## 3. Validations
Following are the basic validation.

 Parameter     | Required?     | Validation(s)               
 ------------- |-------------- | --------------------------- 
 Mobile        | Yes           |  10 Digit ( Valid Indian Mobile  number) 
 Message       | Yes           |  160 characters (Max)      

## 3.1 Error Messages

In case any validation fails, you’ll get an HTTP 400 (Bad Request).

e.g. If you send invalid `Mobile` and message with more than 160 characters, You’ll get response like this:

````json
{
  "Message": "The request is invalid.",
  "ModelState": {
    "sms.Mobile": [
      "Mobile should be a valid Indian mobile number."
    ],
    "sms.Message": [
      "Message can only be 160 characters."
    ]
  }
}
````

## 4. Correlation
A header is sent with _Correlation Id_ in `Response`.

e.g. 

````http
HTTP
...
X-SMSPro-CorrelationId: 1ebc758c-605f-4e99-825a-8b5c5ae9656b
...

````

That’s all! Happy Coding!

[Link: Application Registration]:https://<SERVER_NAME>/SmsPortal/Applications/Create?utm_source=Docs&utm_medium=Prod
[Link: .NET Client SDK]:../client-sdk
[Link: Code Samples]:../code-samples

[Endpoint: OAuth2 Token]: https://<SERVER_NAME>/SMS/oauth2/token

[Endpoint: SMS API]: https://<SERVER_NAME>/SMS/api/SMS

[Endpoint: Batch SMS API]: https://<SERVER_NAME>/SMS/api/Batch

[Endpoint: Delivery OData API]: https://<SERVER_NAME>/SMS/odata/Delivery

[Endpoint: OData Basics]: https://www.odata.org/getting-started/basic-tutorial/
